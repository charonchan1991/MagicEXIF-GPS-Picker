function loadMapFromProvider(a,t){function e(){if(mapIsLoaded){var a={anchor:"e",delay:0,offset:0};r.miniTip(a),o.miniTip(a),r.click(i),o.click(n)}}function i(){if(history.pushState&&mapPosChanged){mapAllowEdit?(moveMarkerTo(mapLatLng),mapOriginalLatLng=$.extend(!0,{},mapLatLng),r.removeClass("active"),o.removeClass("active"),mapPosChanged=!1):n();var a=window.location,t=a.protocol+"//"+a.host+a.pathname+"?agent="+mapAgent+"&provider="+mapProvider+"&edit="+Number(mapAllowEdit)+"&lat="+mapLatLng.lat+"&lng="+mapLatLng.lng+"&zoom="+mapZoom;mapLang.length>0&&(t+="&lang="+mapLang),window.history.replaceState({path:t},"",t+"#applyClicked")}}function n(){mapPosChanged&&(mapLatLng=$.extend(!0,{},mapOriginalLatLng),moveMarkerTo(mapOriginalLatLng),r.removeClass("active"),o.removeClass("active"),mapPosChanged=!1)}function s(){r.addClass("active"),o.addClass("active"),mapPosChanged=!0}var r=$("#mapUICtlConfirm"),o=$("#mapUICtlRestore"),l=function(a,t){var e="",i="",n="";switch(a.toLowerCase()){case"google":case"google_cn":n="goo",e="res/js/map_loader_google.js",i=("google_cn"==a?"http://maps.google.cn/":"https://maps.googleapis.com/")+"maps/api/js?key=AIzaSyB4DUevvypCjQ8gsUj846Pyv-3Ys11-XII&callback=initializeMap",t.length>0&&(i+="&language="+t);break;case"baidu":n="bd",e="res/js/map_loader_baidu.js",i="https://api.map.baidu.com/api?v=2.0&ak=izDTGnjdI3PrIpxBbno664nhOzgIg5Nw&s=1&callback=initializeMap";break;case"amap":case"gaode":n="amp",e="res/js/map_loader_amap.js",i="https://webapi.amap.com/maps?v=1.3&key=6405f9ee601bdcbe4182e53cd20e61fa&callback=initializeMap";break;case"yandex":0==t.length&&(t="en_RU"),n="ydx",e="res/js/map_loader_yandex.js",i="https://api-maps.yandex.ru/2.1/?load=Map,Placemark,collection.Item,util.augment&onload=initializeMap&lang="+t;break;case"osm":case"openstreetmap":case"mapbox":case"bright":case"dark":case"wiki":case"wikimedia":case"carto":case"cartodb":case"esri":case"arcgis":case"google_lfl":case"google_lfl_cn":n="lfl",e="res/js/map_loader_leaflet.js",i="res/js/leaflet.1.0.3.min.js"}return{apiLib:i,loaderJS:e,alias:n}}(a,t);return l.loaderJS.length>0?$.getScript(l.loaderJS,function(t,e,i){200==i.status?$.getScript(l.apiLib,function(t,e,i){200==i.status?"lfl"==l.alias&&($("<link/>",{rel:"stylesheet",type:"text/css",href:"res/css/leaflet.1.0.3.css"}).appendTo("head"),initializeMap(a.toLowerCase())):$("#mapUIMsg").html("Map Service Not Responding")}):$("#mapUIMsg").html("Internal Error")}):$("#mapUIMsg").html("Provider Not Supported"),{enableEdit:s,cancelEdit:n,applyNewPosition:i,initializeTools:e}}var mapProvider=$.query.get("provider"),mapAgent=$.query.get("agent"),mapLang=$.query.get("lang"),mapLatLng={lat:Number($.query.get("lat")),lng:Number($.query.get("lng"))},mapOriginalLatLng=$.extend(!0,{},mapLatLng),mapZoom=Number($.query.get("zoom")),mapAllowEdit=Boolean($.query.get("edit")),mapIsLoaded=!1,mapPosChanged=!1,mapLoaderFunc;$(function(){switch(0==mapProvider.length&&(mapProvider="google"),0==mapZoom&&(mapZoom=4),mapAgent){case"MgExf":case"ExfNw":mapIsLoaded||(mapLoaderFunc=loadMapFromProvider(mapProvider,mapLang));break;default:$("#mapUIMsg").html("Unexpected Agent")}});var MapCoordSrvc={PI:3.141592653589793,x_pi:52.35987755982988,delta:function(a,t){var e=6378245,i=.006693421622965943,n=this.transformLat(t-105,a-35),s=this.transformLng(t-105,a-35),r=a/180*this.PI,o=Math.sin(r);o=1-i*o*o;var l=Math.sqrt(o);return n=180*n/(e*(1-i)/(o*l)*this.PI),s=180*s/(e/l*Math.cos(r)*this.PI),{lat:n,lng:s}},wgs2gcj:function(a,t){var e=this.delta(a,t);return{lat:a+e.lat,lng:t+e.lng}},gcj2wgs:function(a,t){var e=this.delta(a,t);return{lat:a-e.lat,lng:t-e.lng}},gcj2wgs_exact:function(a,t){for(var e,i,n=.01,s=.01,r=a-n,o=t-s,l=a+n,g=t+s,p=0;;){e=(r+l)/2,i=(o+g)/2;var c=this.gcj_encrypt(e,i);if(n=c.lat-a,s=c.lng-t,Math.abs(n)<1e-9&&Math.abs(s)<1e-9)break;if(n>0?l=e:r=e,s>0?g=i:o=i,++p>1e4)break}return{lat:e,lng:i}},gcj2bd:function(a,t){var e=t,i=a,n=Math.sqrt(e*e+i*i)+2e-5*Math.sin(i*this.x_pi),s=Math.atan2(i,e)+3e-6*Math.cos(e*this.x_pi);return bdLng=n*Math.cos(s)+.0065,bdLat=n*Math.sin(s)+.006,{lat:bdLat,lng:bdLng}},bd2gcj:function(a,t){var e=t-.0065,i=a-.006,n=Math.sqrt(e*e+i*i)-2e-5*Math.sin(i*this.x_pi),s=Math.atan2(i,e)-3e-6*Math.cos(e*this.x_pi),r=n*Math.cos(s);return{lat:n*Math.sin(s),lng:r}},bd2wgs:function(a,t){if(this.insideChina(a,t)){var e=this.bd2gcj(a,t);return this.gcj2wgs(e.lat,e.lng)}return{lat:a,lng:t}},wgs2bd:function(a,t){if(this.insideChina(a,t)){var e=this.wgs2gcj(a,t);return this.gcj2bd(e.lat,e.lng)}return{lat:a,lng:t}},distance:function(a,t,e,i){var n=Math.cos(a*this.PI/180)*Math.cos(e*this.PI/180)*Math.cos((t-i)*this.PI/180),s=Math.sin(a*this.PI/180)*Math.sin(e*this.PI/180),r=n+s;return r>1&&(r=1),r<-1&&(r=-1),6371e3*Math.acos(r)},insideChina:function(a,t){var e=[[97.03125,43.389082],[87.890625,49.837982],[78.398438,45.336702],[78.574219,43.068888],[72.421875,39.027719],[77.783203,34.741612],[77.519531,31.952162],[80.507813,29.53523],[81.958008,30.031055],[86.000977,27.916767],[88.769531,27.25463],[90.395508,27.877928],[91.845703,27.683528],[96.020508,28.998532],[98.701172,26.588527],[97.470703,24.246965],[98.920898,22.105999],[100.986328,21.0845],[105.292969,22.958393],[107.797852,21.166484],[107.578125,18.39623],[111.005859,13.197165],[114.213867,7.754537],[117.993164,9.925566],[119.575195,19.766704],[124.628906,23.362429],[124.145508,39.53794],[126.826172,41.178654],[130.869141,42.488302],[135.131836,48.04871],[130.297852,49.124219],[124.936523,53.800651],[120.498047,53.46189],[116.455078,50.148746],[114.125977,46.437857],[108.588867,43.261206]];return this.insidePolygon([t,a],e)},insideSAR:function(a,t){var e=!1,i=[[114.008904,22.51002],[114.054909,22.501773],[114.086838,22.531902],[114.120483,22.532537],[114.166832,22.559489],[114.214897,22.555367],[114.23069,22.540464],[114.248543,22.552513],[114.353085,22.566449],[114.482346,22.423089],[114.45179,22.142479],[113.947449,22.128581],[113.827972,22.179139],[113.788147,22.279566],[113.888397,22.41928]];if(!(e=this.insidePolygon([t,a],i))){var n=[[113.531985,22.21351],[113.541427,22.213113],[113.544302,22.217086],[113.550568,22.216689],[113.581553,22.559489],[113.609962,22.131284],[113.568764,22.098046],[113.547735,22.111406],[113.548508,22.144164],[113.540998,22.153662],[113.526621,22.18359],[113.533831,22.204809]];e=this.insidePolygon([t,a],n)}return e},insideTaiwan:function(a,t){var e=[[121.069336,25.710837],[118.795166,23.63446],[120.289307,21.074249],[121.794434,21.820708],[122.607422,25.413509]];return this.insidePolygon([t,a],e)},insidePolygon:function(a,t){for(var e=a[0],i=a[1],n=!1,s=0,r=t.length-1;s<t.length;r=s++){var o=t[s][0],l=t[s][1],g=t[r][0],p=t[r][1];l>i!=p>i&&e<(g-o)*(i-l)/(p-l)+o&&(n=!n)}return n},transformLat:function(a,t){var e=2*a-100+3*t+.2*t*t+.1*a*t+.2*Math.sqrt(Math.abs(a));return e+=2*(20*Math.sin(6*a*this.PI)+20*Math.sin(2*a*this.PI))/3,e+=2*(20*Math.sin(t*this.PI)+40*Math.sin(t/3*this.PI))/3,e+=2*(160*Math.sin(t/12*this.PI)+320*Math.sin(t*this.PI/30))/3},transformLng:function(a,t){var e=300+a+2*t+.1*a*a+.1*a*t+.1*Math.sqrt(Math.abs(a));return e+=2*(20*Math.sin(6*a*this.PI)+20*Math.sin(2*a*this.PI))/3,e+=2*(20*Math.sin(a*this.PI)+40*Math.sin(a/3*this.PI))/3,e+=2*(150*Math.sin(a/12*this.PI)+300*Math.sin(a/30*this.PI))/3}};