function loadMapFromProvider(a,e){function o(){if(history.pushState&&mapPosChanged){mapAllowEdit?(moveMarkerTo(mapLatLng),mapOriginalLatLng=$.extend(!0,{},mapLatLng),i.removeClass("active"),s.removeClass("active"),mapPosChanged=!1):t();var a=window.location,e=a.protocol+"//"+a.host+a.pathname+"?agent="+mapAgent+"&provider="+mapProvider+"&edit="+Number(mapAllowEdit)+"&lat="+mapLatLng.lat+"&lng="+mapLatLng.lng+"&zoom="+mapZoom;mapLang.length>0&&(e+="&lang="+mapLang),window.history.replaceState({path:e},"",e+"#applyClicked")}}function t(){mapPosChanged&&(mapLatLng=$.extend(!0,{},mapOriginalLatLng),moveMarkerTo(mapOriginalLatLng),i.removeClass("active"),s.removeClass("active"),mapPosChanged=!1)}var i=$("#mapUICtlConfirm"),s=$("#mapUICtlRestore"),l=function(a,e){var o="",t="",i="";switch(a.toLowerCase()){case"google":case"google_cn":i="goo",o="res/js/map_loader_google.js",t=("google_cn"==a?"http://maps.google.cn/":"https://maps.googleapis.com/")+"maps/api/js?key=AIzaSyB4DUevvypCjQ8gsUj846Pyv-3Ys11-XII&callback=initializeMap",e.length>0&&(t+="&language="+e);break;case"baidu":i="bd",o="res/js/map_loader_baidu.js",t="https://api.map.baidu.com/api?v=2.0&ak=izDTGnjdI3PrIpxBbno664nhOzgIg5Nw&s=1&callback=initializeMap";break;case"amap":case"gaode":i="amp",o="res/js/map_loader_amap.js",t="https://webapi.amap.com/maps?v=1.3&key=6405f9ee601bdcbe4182e53cd20e61fa&callback=initializeMap";break;case"yandex":0==e.length&&(e="en_RU"),i="ydx",o="res/js/map_loader_yandex.js",t="https://api-maps.yandex.ru/2.1/?load=Map,Placemark,collection.Item,util.augment&onload=initializeMap&lang="+e;break;case"osm":case"openstreetmap":case"mapbox":case"bright":case"dark":case"wiki":case"wikimedia":case"carto":case"cartodb":case"esri":case"arcgis":case"google_lfl":case"google_lfl_cn":case"google_stl":case"google_stl_cn":i="lfl",o="res/js/map_loader_leaflet.js",t="res/js/leaflet.1.0.3.min.js"}return{apiLib:t,loaderJS:o,alias:i}}(a,e);return l.loaderJS.length>0?$.getScript("res/js/map_coord_srvc.js",function(){$.getScript(l.loaderJS,function(e,o,t){200==t.status?$.getScript(l.apiLib,function(e,o,t){200==t.status?"lfl"==l.alias&&($("<link/>",{rel:"stylesheet",type:"text/css",href:"res/css/leaflet.1.0.3.css"}).appendTo("head"),initializeMap(a.toLowerCase())):$("#mapUIMsg").html("Map Service Not Responding")}):$("#mapUIMsg").html("Internal Error")})}):$("#mapUIMsg").html("Provider Not Supported"),{enableEdit:function(){i.addClass("active"),s.addClass("active"),mapPosChanged=!0},cancelEdit:t,applyNewPosition:o,initializeTools:function(){if(mapIsLoaded){var a={anchor:"e",delay:0,offset:0};i.miniTip(a),s.miniTip(a),i.click(o),s.click(t)}}}}var mapProvider=$.query.get("provider"),mapAgent=$.query.get("agent"),mapLang=$.query.get("lang"),mapLatLng={lat:Number($.query.get("lat")),lng:Number($.query.get("lng"))},mapOriginalLatLng=$.extend(!0,{},mapLatLng),mapZoom=Number($.query.get("zoom")),mapAllowEdit=Boolean($.query.get("edit")),mapIsLoaded=!1,mapPosChanged=!1,mapLoaderFunc;$(function(){switch(0==mapProvider.length&&(mapProvider="google"),0==mapZoom&&(mapZoom=4),mapAgent){case"MgExf":case"ExfNw":mapIsLoaded||(mapLoaderFunc=loadMapFromProvider(mapProvider,mapLang));break;default:$("#mapUIMsg").html("Unexpected Agent")}});