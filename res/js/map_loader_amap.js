function initializeMap(){var a=transformToMap(mapLatLng);map=new AMap.Map("mapUICanvas",{zoom:mapZoom,center:a,lang:mapLang}),mapIsLoaded=!0;mapMarker=new AMap.Marker({position:a,map:map,icon:"res/img/pin_normal.png",offset:new AMap.Pixel(-11,-30),draggable:!0});var e=$("#mapUICtl"),n={dom:e[0],addTo:function(){map.getContainer().appendChild(n.dom)},removeFrom:function(){n.dom.parentNode==map.getContainer()&&map.getContainer().removeChild(n.dom)}};map.addControl(n);var t=AMap.event.addListener(map,"complete",function(){e.show(),mapLoaderFunc.initializeTools(),AMap.event.removeListener(t)});AMap.event.addListener(map,"zoomend",function(){mapZoom=map.getZoom()});var r;AMap.event.addListener(mapMarker,"mousedown",function(a){var e=map.lnglatTocontainer(mapMarker.getPosition());r=new AMap.Pixel(e.getX()-a.pixel.getX(),e.getY()-a.pixel.getY()),delete e}),AMap.event.addListener(mapMarker,"dragstart",function(a){mapMarker.setIcon("res/img/pin_dragging_faded.png")}),AMap.event.addListener(mapMarker,"mouseup",function(a){mapMarker.setIcon("res/img/pin_normal.png")}),AMap.event.addListener(mapMarker,"dragend",function(a){var e=new AMap.Pixel(a.pixel.getX()+r.getX(),a.pixel.getY()+r.getY()),n=map.containTolnglat(e),t=n.getLat(),o=n.getLng();if(MapCoordSrvc.insideChina(t,o))if(MapCoordSrvc.insideTaiwan(t,o))mapLatLng.lat=t,mapLatLng.lng=o;else{var p=MapCoordSrvc.gcj2wgs(t,o);mapLatLng.lat=p.lat,mapLatLng.lng=p.lng}else mapLatLng.lat=t,mapLatLng.lng=o;mapLoaderFunc.enableEdit(),delete e,delete n})}function moveMarkerTo(a){var e=transformToMap(a);mapMarker.setPosition(e),map.panTo(e)}function transformToMap(a){if(MapCoordSrvc.insideChina(a.lat,a.lng)){if(MapCoordSrvc.insideTaiwan(a.lat,a.lng))return new AMap.LngLat(a.lng,a.lat);var e=MapCoordSrvc.wgs2gcj(a.lat,a.lng);return new AMap.LngLat(e.lng,e.lat)}return new AMap.LngLat(a.lng,a.lat)}var map,mapMarker;